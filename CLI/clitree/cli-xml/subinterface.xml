<?xml version="1.0" encoding="UTF-8"?>
<!--
Copyright 2020 Broadcom. The term Broadcom refers to Broadcom Inc. and/or
its subsidiaries.

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
-->

<CLISH_MODULE
    xmlns="http://www.dellemc.com/sonic/XMLSchema"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xmlns:xi="http://www.w3.org/2001/XInclude"
    xsi:schemaLocation="http://www.dellemc.com/sonic/XMLSchema
    http://www.dellemc.com/sonic/XMLSchema/clish.xsd"
    >

    <VIEW name="enable-view">
        <COMMAND
            name="show subinterfaces"
            help="Show Sub-interfaces infromation"
            />
        <COMMAND
            name="show subinterfaces status"
            help="Show Sub-interfaces statusinfromation"
            >
            <ACTION builtin="clish_pyobj">sonic_cli_show_subinterface status_sonic</ACTION>
        </COMMAND>
        <COMMAND
           name="show running-configuration subinterface"
           help="Show subinterface config">
           <PARAM
             name="if-subcommands"
             help="Interface subcommands"
             mode="switch"
             ptype="SUBCOMMAND"
             optional="true"
             >
             <PARAM
               name="subifname"
               help="Sub Interface"
               ptype="PHY_SUB_INTERFACE"
               optional="true">
            </PARAM>
            <PARAM
                name="PortChannel"
                help="Physical Interface"
                ptype="SUBCOMMAND"
                mode="subcommand"
                >
                <PARAM
                    name="pch_num"
                    help="Physical Interface"
                    ptype="LAG_ID_SUBID"
                    optional="true"
                    >
                </PARAM>
            </PARAM>
        </PARAM>
        <ACTION builtin="clish_pyobj">sonic_cli_show_config show_view views=configure-subif view_keys="name=${subifname}${PortChannel}${pch_num}" </ACTION>
      </COMMAND>

    </VIEW>



    <VIEW
        name="configure-subif-view"
        prompt="${SYSTEM_NAME}(conf-subif-${iface})# "
        depth="2"
        >
        <NAMESPACE
            ref="configure-view"
            help="false"
            completion="false"
            />
        <COMMAND
            name="show configuration"
            help = "show configuration">
            <ACTION builtin="clish_pyobj">sonic_cli_show_config show_view views=configure-subif view_keys="name=${iface}" </ACTION>
        </COMMAND>
        <COMMAND
            name="no"
            help="Negate a command or set its defaults"
            />
        <COMMAND name="encapsulation" help="Configure encapsulation for sub-interface"/>
        <COMMAND name="encapsulation dot1q" help="Configure encapsulation type as DOT1Q"/>
        <COMMAND name="encapsulation dot1q vlan-id" help="Configure DOT1Q vlan ID" >
            <PARAM name="vlanid" ptype="VLAN_ID" help="VLAN ID" dbpath="sonic-interface:sonic-interface/VLAN_SUB_INTERFACE/VLAN_SUB_INTERFACE_LIST/vlan"> </PARAM>
            <ACTION
                builtin="clish_restcl">
                oper=PATCH 
                url=/restconf/data/openconfig-interfaces:interfaces/interface=${parent}/subinterfaces/subinterface=${index}/openconfig-vlan:vlan/config/vlan-id 
                body={ "openconfig-vlan:vlan-id": ${vlanid} }
            </ACTION>
        </COMMAND>
        <COMMAND name="no encapsulation" help="Unconfigure encapsulation for sub-interface">
            <ACTION
                builtin="clish_restcl">
                oper=DELETE 
                url=/restconf/data/openconfig-interfaces:interfaces/interface=${parent}/subinterfaces/subinterface=${index}/openconfig-vlan:vlan/config/vlan-id 
            </ACTION>
        </COMMAND>

        <COMMAND
            name="mtu"
            help="Configure MTU">
            <PARAM
                name="mtu"
                help="MTU of the interface"
                dbpath="sonic-interface:sonic-interface/VLAN_SUB_INTERFACE/VLAN_SUB_INTERFACE_LIST/mtu"
                ptype="RANGE_MTU" />
            <ACTION builtin="clish_restcl">oper=PATCH url=/restconf/data/openconfig-interfaces:interfaces/interface=${parent}/subinterfaces/subinterface=${index}/config/openconfig-interfaces-ext:mtu body={"openconfig-interfaces-ext:mtu": ${mtu}}</ACTION>
        </COMMAND>
        <COMMAND
            name="no mtu"
            help="Remove MTU">
            <ACTION builtin="clish_restcl">oper=PATCH url=/restconf/data/openconfig-interfaces:interfaces/interface=${parent}/subinterfaces/subinterface=${index}/config/openconfig-interfaces-ext:mtu body={"openconfig-interfaces-ext:mtu": 9100}</ACTION>
        </COMMAND>

        <COMMAND
            name="shutdown"
            help="Disable the interface"
            dbpath="sonic-interface:sonic-interface/VLAN_SUB_INTERFACE/VLAN_SUB_INTERFACE_LIST/admin_status=down">
        <ACTION builtin="clish_restcl">oper=PATCH url=/restconf/data/openconfig-interfaces:interfaces/interface=${parent}/subinterfaces/subinterface=${index}/config/enabled body={"openconfig-interfaces:enabled": false}</ACTION>
        </COMMAND>
        <COMMAND
            name="no shutdown"
            help="Enable the interface"
            dbpath="sonic-interface:sonic-interface/VLAN_SUB_INTERFACE/VLAN_SUB_INTERFACE_LIST/admin_status=up">
        <ACTION builtin="clish_restcl">oper=PATCH url=/restconf/data/openconfig-interfaces:interfaces/interface=${parent}/subinterfaces/subinterface=${index}/config/enabled body={"openconfig-interfaces:enabled": true}</ACTION>
        </COMMAND>

        <MACRO name="IP-UNNUM-CONFIG-OPTIONS" arg="${parent}.${index},sonic-interface:sonic-interface/VLAN_SUB_INTERFACE/VLAN_SUB_INTERFACE_LIST/id={name},sonic-interface:sonic-interface/VLAN_SUB_INTERFACE/VLAN_SUB_INTERFACE_LIST"> </MACRO>
        <MACRO name="IP-UNNUM-NO-CONFIG-OPTIONS" arg="${parent}.${index} "> </MACRO>
    </VIEW>
</CLISH_MODULE>
