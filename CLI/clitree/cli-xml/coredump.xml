<?xml version='1.0' encoding='UTF-8'?>
<!DOCTYPE CLISH_MODULE [
]>
<CLISH_MODULE
      xmlns="http://www.dellemc.com/sonic/XMLSchema"
      xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
      xmlns:xi="http://www.w3.org/2001/XInclude"
      xsi:schemaLocation="http://www.dellemc.com/sonic/XMLSchema 
      http://www.dellemc.com/sonic/XMLSchema/clish.xsd"
      >

  <!--MODE : config terminal -->
    <VIEW name="configure-view">
        <COMMAND
            name="core"
            help="Configure coredump">
        </COMMAND>
        <COMMAND
            name="no core"
            help="Disable coredump"
            command_tables="sonic-coredump:sonic-coredump/COREDUMP/COREDUMP_LIST/id={id}"
            command_keys="id=config"
            dbpath="sonic-coredump:sonic-coredump/COREDUMP/COREDUMP_LIST/enabled=false">
            <ACTION
                 builtin="clish_pyobj">sonic_cli_coredump disable
            </ACTION>
            <DOCGEN>
                <DESCRIPTION>
                    Disable the cability to generate a core file when an application crash
                    is detected by the kernel.
                </DESCRIPTION>
                <USAGE>
                    sonic(config)# no core
                </USAGE>
                <EXAMPLE>
                    sonic# configure terminal
                    sonic(config)# no core
                </EXAMPLE>
            </DOCGEN>
        </COMMAND>
        <COMMAND
            name="core enable"
            help="Enable coredump"
            command_tables="sonic-coredump:sonic-coredump/COREDUMP/COREDUMP_LIST/id={id}"
            command_keys="id=config"
            dbpath="sonic-coredump:sonic-coredump/COREDUMP/COREDUMP_LIST/enabled=true">
            <ACTION
                builtin="clish_pyobj">sonic_cli_coredump enable
            </ACTION>
            <DOCGEN>
                <DESCRIPTION>
                    Enable the cability to generate a core file when an application crash
                    is detected by the kernel.
                </DESCRIPTION>
                <USAGE>
                    sonic(config)# core enable
                </USAGE>
                <EXAMPLE>
                    sonic# configure terminal
                    sonic(config)# core enable
                </EXAMPLE>
            </DOCGEN>
        </COMMAND>
   </VIEW>

    <VIEW name="enable-view">
        <COMMAND
            name="show core"
            help="Show core files information">
        </COMMAND>
        <COMMAND
            name="show core list"
            help="Show core files list">
            <ACTION
                builtin="clish_pyobj">sonic_cli_coredump list show_coredump_list.j2
            </ACTION>
            <DOCGEN>
                <DESCRIPTION>
                    Use this command to list a summary of the core files generated by the kernel. The following information
                    about each core file is also displayed.
                     - TIME The time of the crash, as reported by the kernel in UTC
                     - PID: The identifier of the process that crashed
                     - SIG: The signal that caused the process to crash, when applicable
                     - COREFILE: Indicates whether the captured core file exists on local disk or has been removed
                     - EXE: The application executable that has crashed
                </DESCRIPTION>
                <USAGE>
                    sonic# show core list
                </USAGE>
                <EXAMPLE>
                    sonic# show core list
                            TIME               PID SIG COREFILE EXE
                    2020-05-16 11:54:33      26480  11 present  clish
                    2020-05-15 01:25:16       6195  11 present  crashme
                    2020-05-15 00:45:28      13604  11 present  crashme
                    2020-05-14 02:11:11       3197  11 present  crashme
                    2020-05-13 01:10:56      17844  11 missing  crashme
                    2020-05-13 01:10:55      17728  11 present  crashme
                </EXAMPLE>
            </DOCGEN>
        </COMMAND>
        <COMMAND
            name="show core config"
            help="Show coredump configuration">
            <ACTION
                builtin="clish_pyobj">sonic_cli_coredump config show_coredump_config.j2
            </ACTION>
            <DOCGEN>
                <DESCRIPTION>
                    Display the coredump configuration. Use this command to display if the coredump feature is administratively enabled or disabled.
                </DESCRIPTION>
                <USAGE>
                    sonic# show core config
                </USAGE>
                <EXAMPLE>
                    sonic# show core config
                    Coredump : Enabled
                </EXAMPLE>
            </DOCGEN>
        </COMMAND>
        <COMMAND
            name="show core info"
            help="Show detailed core file information">
            <PARAM name="key" help="PID or executable name" ptype="STRING" optional="false"/>
            <ACTION
                builtin="clish_pyobj">sonic_cli_coredump info show_coredump_info.j2 ${key}
            </ACTION>
            <DOCGEN>
                <DESCRIPTION>
                    Use this command to display detailed information about a crash that has occured in the system. This command
                    takes processid or executable name as input to search and display the corresponding crash information. If multiple
                    core files are found which satisfy the match condition, information of all core files is displayed.

                    The following information about matching core files is displayed:
                    -  Time: The time of the crash, as reported by the kernel in UTC
                    -  Executable: The full path to the application executable that has crashed"
                    -  Core File: The file name of the application core dump of the executable that has crashed
                    -  PID: The identifier of the process that crashed
                    -  User ID: The user identifier of the process that crashed
                    -  Group ID: The group identifier of the process that crashed
                    -  Signal: The signal that caused the process to crash, when applicable
                    -  Command Line: The command line arguments of the process that crashed
                    -  Boot ID: The unique identifier of the local system that is generated and set on each system boot up event
                    -  Machine ID: The unique machine identifier of the local system that is set during installation
                    -  Core File Found: Indicates whether the captured core file exists on local disk or has been removed
                    -  Crash Message: A copy of the application stack trace information of the process crashed
                </DESCRIPTION>
                <USAGE>
                    sonic# show core info clish
                </USAGE>
                <EXAMPLE>
                    sonic# show core info clish
                    Time            : 2020-05-16 11:54:33
                    Executable      : /usr/sbin/cli/clish
                    Core File       : /var/lib/systemd/coredump/core.clish.1000.8f1cad11c59840318a6df3aa6ed3633e.26480.1589630073000000000000.lz4
                    PID             : 26480
                    User ID         : 1000
                    Group ID        : 1000
                    Signal          : 11
                    Command Line    : /usr/sbin/cli/clish
                    Boot ID         : 8f1cad11c59840318a6df3aa6ed3633e
                    Machine ID      : fc0a437952314ee5a585a94ceaa480af
                    Core File Found : present
                    Crash Message   :
                    Process 26480 (clish) of user 1000 dumped core.
                    Stack trace of thread 152:
                    #0  0x00007f30f516357a PyEval_EvalFrameEx (libpython2.7.so.1.0)
                    #1  0x00007f30f52cc29c PyEval_EvalCodeEx (libpython2.7.so.1.0)
                    #2  0x00007f30f5220670 n/a (libpython2.7.so.1.0)
                    #3  0x00007f30f51b85c3 PyObject_Call (libpython2.7.so.1.0)
                    #4  0x00007f30f52cb6c7 PyEval_CallObjectWithKeywords (libpython2.7.so.1.0)
                    #5  0x00007f30ebb2f43a n/a (/usr/sbin/cli/.libs/clish_plugin_clish.so)
                </EXAMPLE>
            </DOCGEN>
        </COMMAND>
    </VIEW>
</CLISH_MODULE>
