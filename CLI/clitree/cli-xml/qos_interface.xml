<?xml version="1.0" encoding="UTF-8"?>

<!--
Copyright 2019 Dell, Inc.

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
-->

<CLISH_MODULE
    xmlns="http://www.dellemc.com/sonic/XMLSchema"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xmlns:xi="http://www.w3.org/2001/XInclude"
    xsi:schemaLocation="http://www.dellemc.com/sonic/XMLSchema
    http://www.dellemc.com/sonic/XMLSchema/clish.xsd"
    >
  <VIEW name="configure-if-view">
        <COMMAND
            name="queue"
            help="Queue configuration">
           <PARAM
               name="qid"
               help="queue name"
               ptype="STRING_32"
               >
              <PARAM 
                name="wred-policy"
                help="WRED policy" 
                mode="subcommand"
                ptype="SUBCOMMAND">
                <PARAM
                    name="wred_prof_name"
                    help="WRED profile name"
                    ptype="STRING_32"
                    >
                </PARAM>
              </PARAM>
            </PARAM>
            <ACTION builtin="clish_pyobj">
                sonic_cli_qos patch_openconfig_qos_ext_qos_queues_queue_wred_config_wred_profile ${iface}:${qid} ${wred_prof_name}
            </ACTION>
        </COMMAND>

        <COMMAND
            name="scheduler-policy"
            help="Scheduler Policy configuration">
           <PARAM
               name="sp_name"
               help="Scheduler Policy name"
               ptype="STRING_32"
               >
            </PARAM>
            <ACTION builtin="clish_pyobj">
                sonic_cli_qos patch_openconfig_qos_qos_interfaces_interface_output_scheduler_policy_config_name ${iface} ${sp_name}
            </ACTION>
        </COMMAND>

        <COMMAND name="no scheduler-policy" help="Unconfigure a scheduler policy">
            <ACTION builtin="clish_restcl">
                oper=DELETE url=/restconf/data/openconfig-qos:qos/interfaces/interface=${iface}/output/scheduler-policy/config/name
            </ACTION>
        </COMMAND>
        <COMMAND
            name="qos-map"
            help="QoS Map Configuration"
            >
        </COMMAND>
        <COMMAND
            name="no qos-map"
            help="QoS Map Unconfiguration"
            >
        </COMMAND>

        <COMMAND
            name="qos-map dscp-tc"
            help="DSCP to TC map configuration">
           <PARAM
               name="dscp_tc_map_name"
               help="DSCP to TC map name"
               ptype="STRING_32"
               >
            </PARAM>
            <ACTION>
                python $SONIC_CLI_ROOT/sonic_cli_qos.py patch_openconfig_qos_maps_ext_qos_interfaces_interface_interface_maps_config_dscp_tc_map ${iface} ${dscp_tc_map_name}
            </ACTION>
        </COMMAND>


        <COMMAND name="no qos-map dscp-tc" help="Unconfigure a DSCP to TC map">
            <ACTION builtin="clish_restcl">
                oper=DELETE url=/restconf/data/openconfig-qos:qos/interfaces/interface=${iface}/openconfig-qos-maps-ext:interface-maps/config/dscp-to-forwarding-group
            </ACTION>
        </COMMAND>

        <COMMAND
            name="qos-map dot1p-tc"
            help="DOT1P to TC map configuration">
           <PARAM
               name="dot1p_tc_map_name"
               help="DOT1P to TC map name"
               ptype="STRING_32"
               >
            </PARAM>
            <ACTION>
                python $SONIC_CLI_ROOT/sonic_cli_qos.py patch_openconfig_qos_maps_ext_qos_interfaces_interface_interface_maps_config_dot1p_tc_map ${iface} ${dot1p_tc_map_name}
            </ACTION>
        </COMMAND>


        <COMMAND name="no qos-map dot1p-tc" help="Unconfigure a DOT1P to TC map">
            <ACTION builtin="clish_restcl">
                oper=DELETE url=/restconf/data/openconfig-qos:qos/interfaces/interface=${iface}/openconfig-qos-maps-ext:interface-maps/config/dot1p-to-forwarding-group
            </ACTION>
        </COMMAND>

        <COMMAND
            name="qos-map tc-queue"
            help="TC to Queue map configuration">
           <PARAM
               name="tc_queue_map_name"
               help="TC to Queue map name"
               ptype="STRING_32"
               >
           </PARAM>
           <ACTION>
                python $SONIC_CLI_ROOT/sonic_cli_qos.py patch_openconfig_qos_maps_ext_qos_interfaces_interface_interface_maps_config_tc_queue_map ${iface} ${tc_queue_map_name}
           </ACTION>
       </COMMAND>

       <COMMAND name="no qos-map tc-queue" help="Unconfigure a TC to Queue map">
            <ACTION builtin="clish_restcl">
                oper=DELETE url=/restconf/data/openconfig-qos:qos/interfaces/interface=${iface}/openconfig-qos-maps-ext:interface-maps/config/forwarding-group-to-queue
            </ACTION>
        </COMMAND>

        <COMMAND
            name="qos-map tc-pg"
            help="TC to priority group map configuration">
           <PARAM
               name="tc_pg_map_name"
               help="TC to PG map name"
               ptype="STRING_32"
               >
            </PARAM>
            <ACTION>
                python $SONIC_CLI_ROOT/sonic_cli_qos.py patch_openconfig_qos_maps_ext_qos_interfaces_interface_interface_maps_config_tc_pg_map ${iface} ${tc_pg_map_name}
            </ACTION>
        </COMMAND>

        <COMMAND name="no qos-map tc-pg" help="Unconfigure a TC to Priority Group map">
            <ACTION builtin="clish_restcl">
                oper=DELETE url=/restconf/data/openconfig-qos:qos/interfaces/interface=${iface}/openconfig-qos-maps-ext:interface-maps/config/forwarding-group-to-priority-group
            </ACTION>
        </COMMAND>

        <COMMAND
            name="qos-map tc-dscp"
            help="TC to DSCP map configuration">
           <PARAM
               name="tc_dscp_map_name"
               help="TC to DSCP map name"
               ptype="STRING_32"
               >
            </PARAM>
            <ACTION>
                python $SONIC_CLI_ROOT/sonic_cli_qos.py patch_openconfig_qos_maps_ext_qos_interfaces_interface_interface_maps_config_forwarding_group_to_dscp ${iface} ${tc_dscp_map_name}
            </ACTION>
        </COMMAND>


        <COMMAND name="no qos-map tc-dscp" help="Unconfigure a TC to DSCP map">
            <ACTION builtin="clish_restcl">
                oper=DELETE url=/restconf/data/openconfig-qos:qos/interfaces/interface=${iface}/openconfig-qos-maps-ext:interface-maps/config/forwarding-group-to-dscp
            </ACTION>
        </COMMAND>

        <COMMAND
            name="qos-map tc-dot1p"
            help="TC to DOT1P map configuration">
           <PARAM
               name="tc_dot1p_map_name"
               help="TC to DOT1P map name"
               ptype="STRING_32"
               >
            </PARAM>
            <ACTION>
                python $SONIC_CLI_ROOT/sonic_cli_qos.py patch_openconfig_qos_maps_ext_qos_interfaces_interface_interface_maps_config_forwarding_group_to_dot1p ${iface} ${tc_dot1p_map_name}
            </ACTION>
        </COMMAND>


        <COMMAND name="no qos-map tc-dot1p" help="Unconfigure a TC to DOT1P map">
            <ACTION builtin="clish_restcl">
                oper=DELETE url=/restconf/data/openconfig-qos:qos/interfaces/interface=${iface}/openconfig-qos-maps-ext:interface-maps/config/forwarding-group-to-dot1p
            </ACTION>
        </COMMAND>

        <COMMAND name="no queue" help="Negate Queue configuration">
           <PARAM
               name="qid"
               help="queue name"
               ptype="STRING_32"
               >
              <PARAM 
                name="wred-policy"
                help="WRED policy"
                mode="subcommand"
                ptype="SUBCOMMAND">
              </PARAM>
           </PARAM>
           <ACTION builtin="clish_restcl">
                oper=DELETE url=/restconf/data/openconfig-qos:qos/queues/queue=${iface}:${qid}/wred/config/openconfig-qos-ext:wred-profile
            </ACTION>
        </COMMAND>

        <COMMAND
            name="pfc"
            help="PFC Configuration">
            <PARAM 
                name="pfc-subcmd"
                help="PFC commands"
                mode="switch"
                ptype="SUBCOMMAND"
                >
                <PARAM 
                    name="priority"
                    help="PFC Priority commands"
                    ptype="SUBCOMMAND"
                    mode="subcommand"
                    >
                    <PARAM
                        name="dot1p"
                        help="Priority value (0-7)"
                        ptype="RANGE_0_7"
                        >
                    </PARAM>
                </PARAM>
                <PARAM 
                    name="asymmetric"
                    help="PFC asymmetric configuration"
                    ptype="SUBCOMMAND"
                    mode="subcommand"
                    >
                </PARAM>
            </PARAM>
            <ACTION>
            if test "${pfc-subcmd}" = "priority"; then&#xA;
                python $SONIC_CLI_ROOT/sonic_cli_qos.py patch_openconfig_qos_ext_qos_interfaces_interface_pfc_pfc_priorities_pfc_priority_config_enable ${iface} ${dot1p} &#xA;
            else&#xA;
                python $SONIC_CLI_ROOT/sonic_cli_qos.py patch_openconfig_qos_ext_qos_interfaces_interface_pfc_config_asymmetric ${iface} &#xA;
            fi&#xA;
            </ACTION>
        </COMMAND>

        <COMMAND
            name="no pfc"
            help="Delete PFC Configuration">
            <PARAM 
                name="pfc-subcmd"
                help="PFC commands"
                mode="switch"
                ptype="SUBCOMMAND"
                >
                <PARAM 
                    name="priority"
                    help="PFC Priority commands"
                    ptype="SUBCOMMAND"
                    mode="subcommand"
                    >
                    <PARAM
                        name="dot1p"
                        help="Priority value (0-7)"
                        ptype="RANGE_0_7"
                        optional="true"
                        >
                    </PARAM>
                </PARAM>
                <PARAM 
                    name="asymmetric"
                    help="PFC asymmetric configuration"
                    ptype="SUBCOMMAND"
                    mode="subcommand"
                    >
                </PARAM>
            </PARAM>
            <ACTION>
            if test "${pfc-subcmd}" = "priority"; then&#xA;
               if test "${dot1p}" = ""; then&#xA;
                  python $SONIC_CLI_ROOT/sonic_cli_qos.py delete_openconfig_qos_ext_qos_interfaces_interface_pfc_pfc_priorities ${iface} &#xA;
               else&#xA;
                  python $SONIC_CLI_ROOT/sonic_cli_qos.py delete_openconfig_qos_ext_qos_interfaces_interface_pfc_pfc_priorities_pfc_priority_config_enable ${iface} ${dot1p} &#xA;
               fi&#xA;
            else&#xA;
                python $SONIC_CLI_ROOT/sonic_cli_qos.py delete_openconfig_qos_ext_qos_interfaces_interface_pfc_config_asymmetric ${iface} &#xA;
            fi&#xA;
            </ACTION>
        </COMMAND>
  </VIEW>

  <!-- qos interface PortChannel <id> -->
  <VIEW name="configure-lag-view">
        <COMMAND
            name="qos-map dscp-tc"
            help="DSCP to TC map configuration">
           <PARAM
               name="dscp_tc_map_name"
               help="DSCP to TC map name"
               ptype="STRING_32"
               >
            </PARAM>
            <ACTION>
                python $SONIC_CLI_ROOT/sonic_cli_qos.py patch_openconfig_qos_maps_ext_qos_interfaces_interface_interface_maps_config_dscp_tc_map ${po_name} ${dscp_tc_map_name}
            </ACTION>
        </COMMAND>


        <COMMAND name="no qos-map dscp-tc" help="Unconfigure a DSCP to TC map">
            <ACTION builtin="clish_restcl">
                oper=DELETE url=/restconf/data/openconfig-qos:qos/interfaces/interface=${po_name}/openconfig-qos-maps-ext:interface-maps/config/dscp-to-forwarding-group
            </ACTION>
        </COMMAND>

        <COMMAND
            name="qos-map dot1p-tc"
            help="DOT1P to TC map configuration">
           <PARAM
               name="dot1p_tc_map_name"
               help="DOT1P to TC map name"
               ptype="STRING_32"
               >
            </PARAM>
            <ACTION>
                python $SONIC_CLI_ROOT/sonic_cli_qos.py patch_openconfig_qos_maps_ext_qos_interfaces_interface_interface_maps_config_dot1p_tc_map ${po_name} ${dot1p_tc_map_name}
            </ACTION>
        </COMMAND>


        <COMMAND name="no qos-map dot1p-tc" help="Unconfigure a DOT1P to TC map">
            <ACTION builtin="clish_restcl">
                oper=DELETE url=/restconf/data/openconfig-qos:qos/interfaces/interface=${po_name}/openconfig-qos-maps-ext:interface-maps/config/dot1p-to-forwarding-group
            </ACTION>
        </COMMAND>

        <COMMAND
            name="qos-map tc-dscp"
            help="TC to DSCP map configuration">
           <PARAM
               name="tc_dscp_map_name"
               help="TC to DSCP map name"
               ptype="STRING_32"
               >
            </PARAM>
            <ACTION>
                python $SONIC_CLI_ROOT/sonic_cli_qos.py patch_openconfig_qos_maps_ext_qos_interfaces_interface_interface_maps_config_forwarding_group_to_dscp ${po_name} ${tc_dscp_map_name}
            </ACTION>
        </COMMAND>


        <COMMAND name="no qos-map tc-dscp" help="Unconfigure a TC to DSCP map">
            <ACTION builtin="clish_restcl">
                oper=DELETE url=/restconf/data/openconfig-qos:qos/interfaces/interface=${po_name}/openconfig-qos-maps-ext:interface-maps/config/forwarding-group-to-dscp
            </ACTION>
        </COMMAND>

        <COMMAND
            name="qos-map tc-dot1p"
            help="TC to DOT1P map configuration">
           <PARAM
               name="tc_dot1p_map_name"
               help="TC to DOT1P map name"
               ptype="STRING_32"
               >
            </PARAM>
            <ACTION>
                python $SONIC_CLI_ROOT/sonic_cli_qos.py patch_openconfig_qos_maps_ext_qos_interfaces_interface_interface_maps_config_forwarding_group_to_dot1p ${po_name} ${tc_dot1p_map_name}
            </ACTION>
        </COMMAND>


        <COMMAND name="no qos-map tc-dot1p" help="Unconfigure a TC to DOT1P map">
            <ACTION builtin="clish_restcl">
                oper=DELETE url=/restconf/data/openconfig-qos:qos/interfaces/interface=${po_name}/openconfig-qos-maps-ext:interface-maps/config/forwarding-group-to-dot1p
            </ACTION>
        </COMMAND>
  </VIEW>

  <!-- qos interface Vlan <id> -->
  <VIEW name="configure-vlan-view">
        <COMMAND
            name="qos-map dscp-tc"
            help="DSCP to TC map configuration">
           <PARAM
               name="dscp_tc_map_name"
               help="DSCP to TC map name"
               ptype="STRING_32"
               >
            </PARAM>
            <ACTION>
                python $SONIC_CLI_ROOT/sonic_cli_qos.py patch_openconfig_qos_maps_ext_qos_interfaces_interface_interface_maps_config_dscp_tc_map ${vlan_name} ${dscp_tc_map_name}
            </ACTION>
        </COMMAND>


        <COMMAND name="no qos-map dscp-tc" help="Unconfigure a DSCP to TC map">
            <ACTION builtin="clish_restcl">
                oper=DELETE url=/restconf/data/openconfig-qos:qos/interfaces/interface=${vlan_name}/openconfig-qos-maps-ext:interface-maps/config/dscp-to-forwarding-group
            </ACTION>
        </COMMAND>

        <COMMAND
            name="qos-map tc-dscp"
            help="TC to DSCP map configuration">
           <PARAM
               name="tc_dscp_map_name"
               help="TC to DSCP map name"
               ptype="STRING_32"
               >
            </PARAM>
            <ACTION>
                python $SONIC_CLI_ROOT/sonic_cli_qos.py patch_openconfig_qos_maps_ext_qos_interfaces_interface_interface_maps_config_forwarding_group_to_dscp ${vlan_name} ${tc_dscp_map_name}
            </ACTION>
        </COMMAND>


        <COMMAND name="no qos-map tc-dscp" help="Unconfigure a TC to DSCP map">
            <ACTION builtin="clish_restcl">
                oper=DELETE url=/restconf/data/openconfig-qos:qos/interfaces/interface=${vlan_name}/openconfig-qos-maps-ext:interface-maps/config/forwarding-group-to-dscp
            </ACTION>
        </COMMAND>
  </VIEW>
  <VIEW name="enable-view">
    <COMMAND name="show qos" help="Show QoS information">
        <PARAM 
            name="interface"
            help="interface QoS info"
            ptype="SUBCOMMAND"
            mode="subcommand"
            >
            <PARAM
                name="qos-if-subcommands"
                help="QOS Interface subcommands"
                mode="switch"
                ptype="SUBCOMMAND"
                >
                <PARAM
                    name="phy-intf-name"
                    help="Physical Interface"
                    ptype="PHY_INTERFACE"
                    >
                    <PARAM
                        name="queue"
                        help="Queue Id"
                        ptype="SUBCOMMAND"
                        mode="subcommand"
                        optional="true"
                        >
                        <PARAM
                            name="queue-id"
                            help="Queue id: 0, 1, .. etc"
                            ptype="STRING"
                            >
                        </PARAM>
                    </PARAM>
                </PARAM>
                <PARAM
                    name="po-intf-name"
                     help="PortChannel Interface"
                     ptype="PO_INTERFACE"
                     >
                 </PARAM>
                 <PARAM
                     name="vlan-intf-name"
                     help="Vlan Interface"
                     ptype="VLAN_INTERFACE"
                     >
                 </PARAM>
             </PARAM>
         </PARAM>
         <ACTION>
             if test "${qos-if-subcommands}" = "phy-intf-name"; then&#xA;
                if test "${queue}" != ""; then&#xA;
                    python $SONIC_CLI_ROOT/sonic_cli_qos.py get_openconfig_qos_qos_queues_queue ${phy-intf-name}:${queue-id} &#xA;
                else&#xA;
                    python $SONIC_CLI_ROOT/sonic_cli_qos.py get_openconfig_qos_qos_interface_scheduler_policy_config ${phy-intf-name} &#xA;
                fi&#xA;
                python $SONIC_CLI_ROOT/sonic_cli_qos.py get_openconfig_qos_qos_interfaces_interface_maps ${phy-intf-name} &#xA;
                python $SONIC_CLI_ROOT/sonic_cli_qos.py get_openconfig_qos_ext_qos_interfaces_interface_pfc ${phy-intf-name} &#xA;
            elif test "${qos-if-subcommands}" = "po-intf-name"; then&#xA;
                python $SONIC_CLI_ROOT/sonic_cli_qos.py get_openconfig_qos_qos_interfaces_interface_maps ${po-intf-name} &#xA;
            elif test "${qos-if-subcommands}" = "vlan-intf-name"; then&#xA;
                python $SONIC_CLI_ROOT/sonic_cli_qos.py get_openconfig_qos_qos_interfaces_interface_maps ${vlan-intf-name} &#xA;
            fi&#xA;
        </ACTION>
      <xi:include href="include/pipe.xml"/>
    </COMMAND>
  </VIEW>
 </CLISH_MODULE>
