<?xml version="1.0" encoding="UTF-8"?>
<!--
Copyright 2019 Dell, Inc.

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
-->
<CLISH_MODULE
    xmlns="http://www.dellemc.com/sonic/XMLSchema"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xmlns:xi="http://www.w3.org/2001/XInclude"
    xsi:schemaLocation="http://www.dellemc.com/sonic/XMLSchema
                        http://www.dellemc.com/sonic/XMLSchema/clish.xsd"
    >
    <VIEW name="enable-view">

    </VIEW>

    <!-- ============= -->
    <!-- Global Config -->
    <!-- ============= -->
    <VIEW name="configure-view">
        <COMMAND
            name="ip pim"
            command_tables="sonic-pim:sonic-pim/PIM_GLOBALS/PIM_GLOBALS_LIST/vrf-name={vrf_name},address-family={address-family}"
            command_keys="address-family=ipv4"
            render_command_cb="pim_ipv4_gbl"
            help="Configure PIM">
            <PARAM
                name="vrf"
                help="VRF instance configuration"
                mode="subcommand"
                optional="true"
                ptype="SUBCOMMAND">
                <PARAM
                    name="vrf-name"
                    help=""
                    ptype="VRF_OR_DEFAULT"></PARAM>
            </PARAM>
            <PARAM
                name="filter"
                help="Pick one command among following options"
                mode="switch"
                order="true"
                ptype="SUBCOMMAND">
                <PARAM
                    name="ecmp"
                    help="Enable ECMP"
                    ptype="SUBCOMMAND"
                    mode="subcommand">
                    <PARAM
                        name="rebalance"
                        help="Enable ECMP rebalance"
                        ptype="SUBCOMMAND"
                        optional="true"
                        mode="subcommand"></PARAM>
                </PARAM>
                <PARAM
                    name="join-prune-interval"
                    help="Join Prune interval"
                    ptype="SUBCOMMAND"
                    mode="subcommand">
                    <PARAM
                        help="Join Prune interval in seconds"
                        name="jpi"
                        ptype="RANGE_60_600"></PARAM>
                </PARAM>
                <PARAM
                    name="keep-alive-timer"
                    help="Keep Alive timer"
                    ptype="SUBCOMMAND"
                    mode="subcommand">
                    <PARAM
                        help="Keep Alive timer in seconds"
                        name="kat"
                        ptype="RANGE_31_60000"></PARAM>
                </PARAM>
                <PARAM
                    name="ssm"
                    help="Configure SSM"
                    ptype="SUBCOMMAND"
                    mode="subcommand">
                    <PARAM
                        name="prefix-list"
                        help="Configure SSM prefix list"
                        ptype="SUBCOMMAND"
                        mode="subcommand">
                        <PARAM
                            help="Name of a prefix list"
                            name="pln"
                            ptype="STRING"></PARAM>
                    </PARAM>
                </PARAM>
            </PARAM>
            <ACTION builtin="clish_pyobj">
                sonic_cli_pim patch_pim_global_config vrf:${vrf-name} jpi:${jpi} kat:${kat} pln:${pln} ecmp:${ecmp} rebalance:${rebalance} 2>/dev/stdout
            </ACTION>
        </COMMAND>

        <!-- no ip pim -->
        <COMMAND
            name="no ip pim"
            help="Delete PIM configuration">
            <PARAM
                name="vrf"
                help="VRF instance configuration"
                mode="subcommand"
                ptype="SUBCOMMAND"
                optional="true">
                <PARAM
                    name="vrf-name"
                    help=""
                    ptype="VRF_OR_DEFAULT"></PARAM>
            </PARAM>
            <PARAM
                name="filter"
                help="Pick one command among following options"
                mode="switch"
                order="true"
                ptype="SUBCOMMAND">
                <PARAM
                    name="ecmp"
                    help="Disable ECMP"
                    ptype="SUBCOMMAND"
                    mode="subcommand">
                    <PARAM
                        name="rebalance"
                        help="Disable ECMP rebalance"
                        ptype="SUBCOMMAND"
                        optional="true"
                        mode="subcommand"></PARAM>
                </PARAM>
                <PARAM
                    name="jpi"
                    value="join-prune-interval"
                    help="Clear Join Prune interval"
                    ptype="SUBCOMMAND"
                    mode="subcommand">
                </PARAM>
                <PARAM
                    name="kat"
                    value="keep-alive-timer"
                    help="Clear Keep Alive timer"
                    ptype="SUBCOMMAND"
                    mode="subcommand">
                </PARAM>
                <PARAM
                    name="ssm"
                    help="Remove SSM configuration"
                    ptype="SUBCOMMAND"
                    mode="subcommand">
                    <PARAM
                        name="pln"
                        value="prefix-list"
                        help="Remove SSM prefix list"
                        ptype="SUBCOMMAND"
                        mode="subcommand">
                    </PARAM>
                </PARAM>
            </PARAM>
            <ACTION builtin="clish_pyobj">
                sonic_cli_pim del_pim_global_config vrf:${vrf-name} jpi:${jpi} kat:${kat} pln:${pln} ecmp:${ecmp} rebalance:${rebalance} 2>/dev/stdout
            </ACTION>
        </COMMAND>
    </VIEW>

    <!-- =============== -->
    <!-- Ethernet Config -->
    <!-- =============== -->
    <VIEW name="configure-if-view">
        <MACRO name="BIND-INTF-TO-PIM" arg="${iface_uri}"></MACRO>
    </VIEW>

    <!-- ================== -->
    <!-- PortChannel Config -->
    <!-- ================== -->
    <VIEW name="configure-lag-view">
        <MACRO name="BIND-INTF-TO-PIM" arg="${po_name}"></MACRO>
    </VIEW>

    <!-- =========== -->
    <!-- VLAN Config -->
    <!-- =========== -->
    <VIEW name="configure-vlan-view">
        <MACRO name="BIND-INTF-TO-PIM" arg="${vlan_name}"></MACRO>
    </VIEW>

</CLISH_MODULE>
