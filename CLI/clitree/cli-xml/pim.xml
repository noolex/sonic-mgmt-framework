<?xml version="1.0" encoding="UTF-8"?>
<!--
Copyright 2019 Dell, Inc.

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
-->
<CLISH_MODULE
    xmlns="http://www.dellemc.com/sonic/XMLSchema"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xmlns:xi="http://www.w3.org/2001/XInclude"
    xsi:schemaLocation="http://www.dellemc.com/sonic/XMLSchema
                        http://www.dellemc.com/sonic/XMLSchema/clish.xsd"
    >
    <VIEW name="enable-view">

    </VIEW>

    <!-- ============= -->
    <!-- Global Config -->
    <!-- ============= -->
    <VIEW name="configure-view">
        <COMMAND
            name="ip pim"
            help="PIM configuration">
            <PARAM
                name="vrf"
                help="VRF name"
                mode="subcommand"
                optional="true"
                ptype="SUBCOMMAND">
                <PARAM
                    name="vrf-name"
                    help="Configure PIM for the given VRF name"
                    ptype="VRF_NAME"></PARAM>
            </PARAM>
            <PARAM
                name="filter"
                help="Pick one command among following options"
                mode="switch"
                order="true"
                ptype="SUBCOMMAND">
                <PARAM
                    name="join-prune-interval"
                    help="Join prune interval in seconds"
                    ptype="SUBCOMMAND"
                    mode="subcommand">
                    <PARAM
                        help="Range 60-600 seconds"
                        name="jpi"
                        ptype="RANGE_60_600"></PARAM>
                </PARAM>
                <PARAM
                    name="keep-alive-timer"
                    help="Keep alive timer in seconds"
                    ptype="SUBCOMMAND"
                    mode="subcommand">
                    <PARAM
                        help="Range 31-60000 seconds"
                        name="kat"
                        ptype="RANGE_31_60000"></PARAM>
                </PARAM>
                <PARAM
                    name="ssm"
                    help="Configure SSM mode"
                    ptype="SUBCOMMAND"
                    mode="subcommand">
                    <PARAM
                        name="prefix-list-name"
                        help="Configure prefix list name"
                        ptype="SUBCOMMAND"
                        mode="subcommand">
                        <PARAM
                            help="Prefix list name"
                            name="pln"
                            ptype="STRING"></PARAM>
                    </PARAM>
                </PARAM>
                <PARAM
                    name="ecmp"
                    help="Configure ECMP"
                    ptype="SUBCOMMAND"
                    mode="subcommand">
                    <PARAM
                        name="rebalance"
                        help="Enable ECMP rebalance"
                        ptype="SUBCOMMAND"
                        optional="true"
                        mode="subcommand"></PARAM>
                </PARAM>
            </PARAM>
            <ACTION builtin="clish_pyobj">
                sonic_cli_pim patch_openconfig_pim_ext_network_instances_network_instance_protocols_protocol_pim_global_config vrf:${vrf-name} jpi:${jpi} kat:${kat} pln:${pln} ecmp:${ecmp} rebalance:${rebalance} 2>/dev/stdout
            </ACTION>
        </COMMAND>

        <!-- no ip pim -->
        <COMMAND
            name="no ip pim"
            help="PIM configuration">
            <PARAM
                name="vrf"
                help="VRF name"
                mode="subcommand"
                ptype="SUBCOMMAND"
                optional="true">
                <PARAM
                    name="vrf-name"
                    help="Configure PIM for the given VRF name"
                    ptype="VRF_NAME"></PARAM>
            </PARAM>
            <PARAM
                name="filter"
                help="Pick one command among following options"
                mode="switch"
                order="true"
                ptype="SUBCOMMAND">
                <PARAM
                    name="join-prune-interval"
                    help="Join prune interval in seconds"
                    ptype="SUBCOMMAND"
                    mode="subcommand">
                </PARAM>
                <PARAM
                    name="keep-alive-timer"
                    help="Keep alive timer in seconds"
                    ptype="SUBCOMMAND"
                    mode="subcommand">
                </PARAM>
                <PARAM
                    name="ssm"
                    help="Configure SSM mode"
                    ptype="SUBCOMMAND"
                    mode="subcommand">
                    <PARAM
                        name="prefix-list-name"
                        help="Configure prefix list name"
                        ptype="SUBCOMMAND"
                        mode="subcommand">
                    </PARAM>
                </PARAM>
                <PARAM
                    name="ecmp"
                    help="Configure ECMP mode"
                    ptype="SUBCOMMAND"
                    mode="subcommand">
                    <PARAM
                        name="rebalance"
                        help="Enable ECMP rebalance"
                        ptype="SUBCOMMAND"
                        optional="true"
                        mode="subcommand"></PARAM>
                </PARAM>
            </PARAM>
            <ACTION></ACTION>
        </COMMAND>
    </VIEW>

    <!-- =============== -->
    <!-- Ethernet Config -->
    <!-- =============== -->
    <VIEW name="configure-if-view">
        <MACRO name="BIND-INTF-TO-PIM" arg="${iface}"></MACRO>
    </VIEW>

    <!-- ================== -->
    <!-- PortChannel Config -->
    <!-- ================== -->
    <VIEW name="configure-lag-view">
        <MACRO name="BIND-INTF-TO-PIM" arg="${po_name}"></MACRO>
    </VIEW>

    <!-- =========== -->
    <!-- VLAN Config -->
    <!-- =========== -->
    <VIEW name="configure-vlan-view">
        <MACRO name="BIND-INTF-TO-PIM" arg="${vlan_name}"></MACRO>
    </VIEW>

    <!-- =============== -->
    <!-- Loopback Config -->
    <!-- =============== -->
    <VIEW name="configure-lo-view">
        <MACRO name="BIND-INTF-TO-PIM" arg="${lo_name}"></MACRO>
    </VIEW>
</CLISH_MODULE>
