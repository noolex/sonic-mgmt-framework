<?xml version='1.0' encoding='UTF-8'?>
<!DOCTYPE CLISH_MODULE [
]>
<!--
Copyright 2019 Dell, Inc.

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
-->

<CLISH_MODULE
    xmlns="http://www.dellemc.com/sonic/XMLSchema"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xmlns:xi="http://www.w3.org/2001/XInclude"
    xsi:schemaLocation="http://www.dellemc.com/sonic/XMLSchema
                        http://www.dellemc.com/sonic/XMLSchema/clish.xsd"
    >
<!--=========================================================================-->
  <PTYPE
     name="AAA_AUTH_LDAP"
     method="select"
     pattern="ldap(ldap)"
     help=""
     />
<!--=========================================================================-->
  <PTYPE
     name="AAA_AUTH_TACPLUS"
     method="select"
     pattern="tacacs+(tacacs+)"
     help=""
     />
<!--=========================================================================-->
  <PTYPE
     name="AAA_AUTH_RADIUS"
     method="select"
     pattern="radius(radius)"
     help=""
     />
  <!--=========================================================================-->
  <PTYPE
     name="AAA_AUTH_LOCAL"
     method="select"
     pattern="local(local)"
     help=""
     />
  <!--=========================================================================-->
  <PTYPE
     name="AAA_NSS_LOGIN"
     method="select"
     pattern="login(login)"
     help=""
     />
  <!--=========================================================================-->

  <VIEW name="enable-view">
    <COMMAND name="show aaa"
             help="Show aaa info">
      <ACTION>python $SONIC_CLI_ROOT/sonic-cli-aaa.py get_openconfig_system_system_aaa show_aaa.j2</ACTION>
    </COMMAND>
  </VIEW>


  <VIEW name="hidden-cmd-view">
    <COMMAND name="aaa authentication login-method"
             help="AAA authentication login method preference"
             mode="subcommand"
             ptype="SUBCOMMAND">
      <PARAM name="login"
             help="login methods"
             mode="switch"
             ptype="SUBCOMMAND">
          <PARAM name="local"
                 help="local authentication"
                 optional="true"
                 mode="subcommand"
                 ptype="SUBCOMMAND">
              <PARAM name="tacacs+"
                     test='"${radius}"!="radius"'
                     help="tacacs+ authentication"
                     optional="true"
                     ptype="AAA_AUTH_TACPLUS">
              </PARAM>
              <PARAM name="radius"
                     test='"${tacacs+}"!="tacacs+"'
                     help="radius authentication"
                     optional="true"
                     ptype="AAA_AUTH_RADIUS">
              </PARAM>
          </PARAM>
          <PARAM name="tacacs+"
                 help="tacacs+ authentication"
                 optional="true"
                 mode="subcommand"
                 ptype="SUBCOMMAND">
              <PARAM name="local"
                     help="local authentication"
                     optional="true"
                     ptype="AAA_AUTH_LOCAL">
              </PARAM>
          </PARAM>
          <PARAM name="radius"
                 help="radius authentication"
                 optional="true"
                 mode="subcommand"
                 ptype="SUBCOMMAND">
              <PARAM name="local"
                     help="local authentication"
                     optional="true"
                     ptype="AAA_AUTH_LOCAL">
              </PARAM>
          </PARAM>
      </PARAM>
      <ACTION> python $SONIC_CLI_ROOT/sonic-cli-aaa.py put_openconfig_system_system_aaa_authentication_config_authentication_method ${login} ${local} ${tacacs+} ${radius} </ACTION>
    </COMMAND>

    <COMMAND name="no aaa authentication login-method" help="Unconfigure aaa authentication login method">
      <ACTION>python $SONIC_CLI_ROOT/sonic-cli-aaa.py put_openconfig_system_system_aaa_authentication_config_authentication_method local</ACTION>
    </COMMAND>

  </VIEW>

  <VIEW name="configure-view">
    <!-- aaa -->
    <COMMAND name="aaa"
             help="AAA configuration"/>

    <!-- config sub view for aaa authentication -->
    <COMMAND name="aaa authentication"
             help="AAA authentication configuration"/>

    <COMMAND name="aaa authentication failthrough"
             help="AAA authentication failthrough status"
             mode="subcommand"
             ptype="SUBCOMMAND">
      <PARAM name="enable"
             help="failthrough status"
             ptype="ENA_DISA">
      </PARAM>
      <ACTION> if test "${enable}" = "enable" ; then&#xA;
        python $SONIC_CLI_ROOT/sonic-cli-aaa.py put_openconfig_system_ext_system_aaa_authentication_config_failthrough True&#xA;
          else&#xA;
        python $SONIC_CLI_ROOT/sonic-cli-aaa.py put_openconfig_system_ext_system_aaa_authentication_config_failthrough False&#xA;
          fi&#xA;
      </ACTION>
    </COMMAND>

<!--
    <COMMAND name="aaa authentication login-method"
             help="AAA authentication login method preference"
             mode="subcommand"
             ptype="SUBCOMMAND">
      <PARAM name="login"
             help="login methods"
             mode="switch"
             ptype="SUBCOMMAND">
          <PARAM name="local"
                 help="local authentication"
                 optional="true"
                 mode="subcommand"
                 ptype="SUBCOMMAND">
              <PARAM name="tacacs+"
                     test='"${radius}"!="radius"'
                     help="tacacs+ authentication"
                     optional="true"
                     ptype="AAA_AUTH_TACPLUS">
              </PARAM>
              <PARAM name="radius"
                     test='"${tacacs+}"!="tacacs+"'
                     help="radius authentication"
                     optional="true"
                     ptype="AAA_AUTH_RADIUS">
              </PARAM>
          </PARAM>
          <PARAM name="tacacs+"
                 help="tacacs+ authentication"
                 optional="true"
                 mode="subcommand"
                 ptype="SUBCOMMAND">
              <PARAM name="local"
                     help="local authentication"
                     optional="true"
                     ptype="AAA_AUTH_LOCAL">
              </PARAM>
          </PARAM>
          <PARAM name="radius"
                 help="radius authentication"
                 optional="true"
                 mode="subcommand"
                 ptype="SUBCOMMAND">
              <PARAM name="local"
                     help="local authentication"
                     optional="true"
                     ptype="AAA_AUTH_LOCAL">
              </PARAM>
          </PARAM>
      </PARAM>
      <ACTION> python $SONIC_CLI_ROOT/sonic-cli-aaa.py put_openconfig_system_system_aaa_authentication_config_authentication_method ${login} ${local} ${tacacs+} ${radius} </ACTION>
    </COMMAND>
-->
    <COMMAND name="no aaa" help="Unconfigure aaa authentication configuration"/>
    <COMMAND name="no aaa authentication" help="Unconfigure aaa authentication configuration"/>
<!--
    <COMMAND name="no aaa authentication login-method" help="Unconfigure aaa authentication login method">
      <ACTION>python $SONIC_CLI_ROOT/sonic-cli-aaa.py put_openconfig_system_system_aaa_authentication_config_authentication_method local</ACTION>
    </COMMAND>
-->

    <COMMAND name="aaa authentication login"
             help="Configures AAA login authentication"/>

    <COMMAND name="aaa authentication login default"
             help="Configures AAA login authentication default list"
             mode="subcommand"
             ptype="SUBCOMMAND">
      <PARAM name="login"
             help="Selects authentication method"
             mode="switch"
             ptype="SUBCOMMAND">
        <PARAM name="local"
               help="Selects local authentication"
               optional="true"
               mode="subcommand"
               ptype="SUBCOMMAND">
            <PARAM name="group"
                   help="Selects group"
                   optional="true"
                   mode="subcommand"
                   ptype="SUBCOMMAND">
              <PARAM name="remote"
                     help="Selects remote method group"
                     mode="switch"
                     ptype="SUBCOMMAND">
                <PARAM name="tacacs+"
                       test='"${radius}"!="radius" -a "${ldap}"!="ldap"'
                       help="Selects group of all TACACS+ servers"
                       optional="true"
                       mode="subcommand"
                       ptype="SUBCOMMAND">
                </PARAM>
                <PARAM name="radius"
                       test='"${tacacs+}"!="tacacs+" -a "${ldap}"!="ldap"'
                       help="Selects group of all RADIUS servers"
                       optional="true"
                       mode="subcommand"
                       ptype="SUBCOMMAND">
                </PARAM>
                <PARAM name="ldap"
                       test='"${tacacs+}"!="tacacs+" -a "${radius}"!="radius"'
                       help="Selects group of all LDAP servers"
                       optional="true"
                       mode="subcommand"
                       ptype="SUBCOMMAND">
                </PARAM>
              </PARAM>
            </PARAM>
        </PARAM>
        <PARAM name="group"
               help="Selects group"
               optional="true"
               mode="subcommand"
               ptype="SUBCOMMAND">
            <PARAM name="remote"
                     help="Selects remote method group"
                     mode="switch"
                     ptype="SUBCOMMAND">
            <PARAM name="tacacs+"
                   test='"${radius}"!="radius" -a "${ldap}"!="ldap"'
                   help="Selects group of all TACACS+ servers"
                   optional="true"
                   mode="subcommand"
                   ptype="SUBCOMMAND">
                <PARAM name="local"
                       help="Selects local authentication"
                       optional="true"
                       mode="subcommand"
                       ptype="SUBCOMMAND">
                </PARAM>
            </PARAM>
            <PARAM name="radius"
                   help="Selects group of all RADIUS servers"
                   test='"${tacacs+}"!="tacacs+" -a "${ldap}"!="ldap"'
                   optional="true"
                   mode="subcommand"
                   ptype="SUBCOMMAND">
                <PARAM name="local"
                       help="Selects local authentication"
                       optional="true"
                       mode="subcommand"
                       ptype="SUBCOMMAND">
                </PARAM>
            </PARAM>
            <PARAM name="ldap"
                   test='"${tacacs+}"!="tacacs+" -a "${radius}"!="radius"'
                   help="Selects group of all LDAP servers"
                   optional="true"
                   mode="subcommand"
                   ptype="SUBCOMMAND">
                <PARAM name="local"
                       help="Selects local authentication"
                       optional="true"
                       mode="subcommand"
                       ptype="SUBCOMMAND">
                </PARAM>
            </PARAM>
            </PARAM>
        </PARAM>
      </PARAM>

        <ACTION> python $SONIC_CLI_ROOT/sonic-cli-aaa.py put_openconfig_system_system_aaa_authentication_config_login ${__params} </ACTION>
    </COMMAND>

    <COMMAND name="aaa authorization"
             help="Configures AAA authorization"/>

    <COMMAND name="aaa authorization login"
             help="Configures AAA login authorization"/>

    <COMMAND name="aaa authorization login default"
             help="Configures AAA login authorization default list"
             mode="subcommand"
             ptype="SUBCOMMAND">
      <PARAM name="login"
             help="Selects authorization method"
             mode="switch"
             ptype="SUBCOMMAND">
        <PARAM name="local"
               help="Selects local authorization"
               test='"${ldap}"!="ldap"'
               optional="true"
               mode="subcommand"
               ptype="SUBCOMMAND">
        </PARAM>
        <PARAM name="group"
               help="Selects group"
               test='"${local}"!="local"'
               optional="true"
               mode="subcommand"
               ptype="SUBCOMMAND">
            <PARAM name="ldap"
                   help="Selects group of all LDAP servers"
                   mode="subcommand"
                   ptype="SUBCOMMAND">
            </PARAM>
        </PARAM>
      </PARAM>

      <ACTION
          builtin="clish_restcl">oper=PATCH url=/restconf/data/openconfig-system:system/aaa/authorization/openconfig-aaa-ext:login/config/authorization-method body={"openconfig-aaa-ext:authorization-method": ["${local}${ldap}"] }
      </ACTION>
    </COMMAND>

    <COMMAND name="aaa name-service"
             help="Configures AAA name service"/>

    <COMMAND name="aaa name-service passwd"
             help="Configures AAA passwd name-service"
             mode="switch"
             ptype="SUBCOMMAND">
      <PARAM name="method"
             help="Selects name-service method"
             mode="switch"
             ptype="SUBCOMMAND">
        <PARAM name="local"
               help="Selects local name-service"
               test='"${login}"!="login" -a "${ldap}"!="ldap"'
               optional="true"
               mode="subcommand"
               ptype="SUBCOMMAND">
        </PARAM>
        <PARAM name="login"
               help="Selects login name-service"
               test='"${local}"!="local" -a "${ldap}"!="ldap"'
               optional="true"
               mode="subcommand"
               ptype="SUBCOMMAND">
        </PARAM>
        <PARAM name="group"
               help="Selects group"
               test='"${login}"!="login" -a "${local}"!="local"'
               optional="true"
               mode="subcommand"
               ptype="SUBCOMMAND">
            <PARAM name="ldap"
                   help="Selects group of all LDAP servers"
                   mode="subcommand"
                   ptype="SUBCOMMAND">
            </PARAM>
        </PARAM>
      </PARAM>

      <ACTION
          builtin="clish_restcl">oper=PATCH url=/restconf/data/openconfig-system:system/aaa/openconfig-aaa-ext:name-service/config/passwd-method body={"openconfig-aaa-ext:passwd-method": ["${local}${login}${ldap}"] }
      </ACTION>
    </COMMAND>

    <COMMAND name="aaa name-service shadow"
             help="Configures AAA shadow name-service"
             mode="switch"
             ptype="SUBCOMMAND">
      <PARAM name="method"
             help="Selects name-service method"
             mode="switch"
             ptype="SUBCOMMAND">
        <PARAM name="local"
               help="Selects local name-service"
               test='"${login}"!="login" -a "${ldap}"!="ldap"'
               optional="true"
               mode="subcommand"
               ptype="SUBCOMMAND">
        </PARAM>
        <PARAM name="login"
               help="Selects login name-service"
               test='"${local}"!="local" -a "${ldap}"!="ldap"'
               optional="true"
               mode="subcommand"
               ptype="SUBCOMMAND">
        </PARAM>
        <PARAM name="group"
               help="Selects group"
               test='"${login}"!="login" -a "${local}"!="local"'
               optional="true"
               mode="subcommand"
               ptype="SUBCOMMAND">
            <PARAM name="ldap"
                   help="Selects group of all LDAP servers"
                   mode="subcommand"
                   ptype="SUBCOMMAND">
            </PARAM>
        </PARAM>
      </PARAM>

      <ACTION
          builtin="clish_restcl">oper=PATCH url=/restconf/data/openconfig-system:system/aaa/openconfig-aaa-ext:name-service/config/shadow-method body={"openconfig-aaa-ext:shadow-method": ["${local}${login}${ldap}"] }
      </ACTION>
    </COMMAND>

    <COMMAND name="aaa name-service group"
             help="Configures AAA group name-service"
             mode="switch"
             ptype="SUBCOMMAND">
      <PARAM name="method"
             help="Selects name-service method"
             mode="switch"
             ptype="SUBCOMMAND">
        <PARAM name="local"
               help="Selects local name-service"
               test='"${login}"!="login" -a "${ldap}"!="ldap"'
               optional="true"
               mode="subcommand"
               ptype="SUBCOMMAND">
        </PARAM>
        <PARAM name="login"
               help="Selects login name-service"
               test='"${local}"!="local" -a "${ldap}"!="ldap"'
               optional="true"
               mode="subcommand"
               ptype="SUBCOMMAND">
        </PARAM>
        <PARAM name="group"
               help="Selects group"
               test='"${login}"!="login" -a "${local}"!="local"'
               optional="true"
               mode="subcommand"
               ptype="SUBCOMMAND">
            <PARAM name="ldap"
                   help="Selects group of all LDAP servers"
                   mode="subcommand"
                   ptype="SUBCOMMAND">
            </PARAM>
        </PARAM>
      </PARAM>

      <ACTION
          builtin="clish_restcl">oper=PATCH url=/restconf/data/openconfig-system:system/aaa/openconfig-aaa-ext:name-service/config/group-method body={"openconfig-aaa-ext:group-method": ["${local}${login}${ldap}"] }
      </ACTION>
    </COMMAND>

    <COMMAND name="aaa name-service netgroup"
             help="Configures AAA netgroup name-service"
             mode="switch"
             ptype="SUBCOMMAND">
      <PARAM name="method"
             help="Selects name-service method"
             mode="switch"
             ptype="SUBCOMMAND">
        <PARAM name="local"
               help="Selects local name-service"
               test='"${login}"!="login" -a "${ldap}"!="ldap"'
               optional="true"
               mode="subcommand"
               ptype="SUBCOMMAND">
        </PARAM>
        <PARAM name="group"
               help="Selects group"
               test='"${login}"!="login" -a "${local}"!="local"'
               mode="subcommand"
               ptype="SUBCOMMAND">
            <PARAM name="ldap"
                   help="Selects group of all LDAP servers"
                   mode="subcommand"
                   ptype="SUBCOMMAND">
            </PARAM>
        </PARAM>
      </PARAM>

      <ACTION
          builtin="clish_restcl">oper=PATCH url=/restconf/data/openconfig-system:system/aaa/openconfig-aaa-ext:name-service/config/netgroup-method body={"openconfig-aaa-ext:netgroup-method": ["${local}${ldap}"] }
      </ACTION>
    </COMMAND>

    <COMMAND name="aaa name-service sudoers"
             help="Configures AAA sudoers name-service"
             mode="switch"
             ptype="SUBCOMMAND">
      <PARAM name="method"
             help="Selects name-service method"
             mode="switch"
             ptype="SUBCOMMAND">
        <PARAM name="local"
               help="Selects local name-service"
               test='"${login}"!="login" -a "${ldap}"!="ldap"'
               optional="true"
               mode="subcommand"
               ptype="SUBCOMMAND">
        </PARAM>
        <PARAM name="group"
               help="Selects group"
               test='"${login}"!="login" -a "${local}"!="local"'
               mode="subcommand"
               ptype="SUBCOMMAND">
            <PARAM name="ldap"
                   help="Selects group of all LDAP servers"
                   mode="subcommand"
                   ptype="SUBCOMMAND">
            </PARAM>
        </PARAM>
      </PARAM>

      <ACTION
          builtin="clish_restcl">oper=PATCH url=/restconf/data/openconfig-system:system/aaa/openconfig-aaa-ext:name-service/config/sudoers-method body={"openconfig-aaa-ext:sudoers-method": ["${local}${ldap}"] }
      </ACTION>
    </COMMAND>

    <COMMAND name="no aaa authentication login"
             help="Unconfigures AAA login authentication"/>

    <COMMAND name="no aaa authentication login default"
             help="Unconfigures AAA login authentication default list">

      <ACTION
          builtin="clish_restcl">oper=DELETE url=/restconf/data/openconfig-system:system/aaa/authentication/config/authentication-method
      </ACTION>
    </COMMAND>

    <COMMAND name="no aaa authorization"
             help="Unconfigures AAA authorization"/>

    <COMMAND name="no aaa authorization login"
             help="Unconfigures AAA login authorization"/>

    <COMMAND name="no aaa authorization login default"
             help="Unconfigures AAA login authorization default list">

      <ACTION
          builtin="clish_restcl">oper=DELETE url=/restconf/data/openconfig-system:system/aaa/authorization/openconfig-aaa-ext:login/config/authorization-method
      </ACTION>
    </COMMAND>

    <COMMAND name="no aaa name-service"
             help="Unconfigures AAA name-service"/>

    <COMMAND name="no aaa name-service passwd"
             help="Unconfigures AAA passwd name-service">

      <ACTION
          builtin="clish_restcl">oper=DELETE url=/restconf/data/openconfig-system:system/aaa/openconfig-aaa-ext:name-service/config/passwd-method
      </ACTION>
    </COMMAND>

    <COMMAND name="no aaa name-service shadow"
             help="Unconfigures AAA shadow name-service">

      <ACTION
          builtin="clish_restcl">oper=DELETE url=/restconf/data/openconfig-system:system/aaa/openconfig-aaa-ext:name-service/config/shadow-method
      </ACTION>
    </COMMAND>

    <COMMAND name="no aaa name-service group"
             help="Unconfigures AAA group name-service">

      <ACTION
          builtin="clish_restcl">oper=DELETE url=/restconf/data/openconfig-system:system/aaa/openconfig-aaa-ext:name-service/config/group-method
      </ACTION>
    </COMMAND>

    <COMMAND name="no aaa name-service netgroup"
             help="Unconfigures AAA netgroup name-service">

      <ACTION
          builtin="clish_restcl">oper=DELETE url=/restconf/data/openconfig-system:system/aaa/openconfig-aaa-ext:name-service/config/netgroup-method
      </ACTION>
    </COMMAND>

    <COMMAND name="no aaa name-service sudoers"
             help="Unconfigures AAA sudoers name-service">

      <ACTION
          builtin="clish_restcl">oper=DELETE url=/restconf/data/openconfig-system:system/aaa/openconfig-aaa-ext:name-service/config/sudoers-method
      </ACTION>
    </COMMAND>

  </VIEW>

</CLISH_MODULE>
